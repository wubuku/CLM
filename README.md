# CLM (Cable Label Management System)


## Prerequisites

Currently, the dddappp low-code tool is published as a Docker image for developers to experience.

The off-chain services generated by the tool are written in Java and use the MySQL database by default.

So before getting started, you need to:

* Install [Docker](https://docs.docker.com/engine/install/).
* Install MySQL database server.
* Install JDK and Maven.

If you have already installed Docker, you can use Docker to run a MySQL database service. For example:

```shell
sudo docker run -p 3306:3306 --name mysql \
-v ~/docker/mysql/conf:/etc/mysql \
-v ~/docker/mysql/logs:/var/log/mysql \
-v ~/docker/mysql/data:/var/lib/mysql \
-e MYSQL_ROOT_PASSWORD=123456 \
-d mysql:5.7
```

> **Tip**
>
> About DDDML, here is an introductory article: ["Introducing DDDML: The Key to Low-Code Development for Decentralized Applications"](https://github.com/wubuku/Dapp-LCDP-Demo/blob/main/IntroducingDDDML.md). 



### Run dddappp Project Creation Tool


In repository root directory, run:

```shell
docker run \
-v .:/myapp \
wubuku/dddappp-java:master \
--dddmlDirectoryPath /myapp/dddml \
--boundedContextName Dddml.Clm \
--boundedContextJavaPackageName org.dddml.clm \
--javaProjectsDirectoryPath /myapp/src \
--javaProjectNamePrefix clm \
--pomGroupId dddml.clm
```

The command parameters above are straightforward:

* This line `-v .:/myapp \` indicates mounting the local current directory into the `/myapp` directory inside the container.
* `dddmlDirectoryPath` is the directory where the DDDML model files are located. It should be a directory path that can be read in the container.
* Understand the value of the `boundedContextName` parameter as the name of the application you want to develop. When the name has multiple parts, separate them with dots and use the PascalCase naming convention for each part. Bounded-context is a term in Domain-driven design (DDD) that refers to a specific problem domain scope that contains specific business boundaries, constraints, and language. If you cannot understand this concept for the time being, it is not a big deal.
* `boundedContextJavaPackageName` is the Java package name of the off-chain service. According to Java naming conventions, it should be all lowercase and the parts should be separated by dots.
* `javaProjectsDirectoryPath` is the directory path where the off-chain service code is placed. The off-chain service consists of multiple modules (projects). It should be a readable and writable directory path in the container.
* `javaProjectNamePrefix` is the name prefix of each module of the off-chain service. It is recommended to use an all-lowercase name.
* `pomGroupId` is the GroupId of the off-chain service. We use Maven as the project management tool for off-chain service. It should be all lowercase and the parts should be separated by dots.

Now you can try to compile the service. Go to the directory `src` and run:

```shell
mvn compile
```

If there is no unexpected failure, the compilation should be successful.


## Programming

### Write DDDML Model File

In the `dddml` directory in the root of the repository, we have a `CLM.yaml` file. This is the DDDML model file.


## Test the Application

### Creating and Initialize Database

Use a MySQL client to connect to the local MySQL server and execute the following script to create an empty database (assuming the name is `clm`):

```sql
CREATE SCHEMA `clm` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;
```

Go to the `src` directory and package the Java project:

```shell
mvn package
```

Then, run a command-line tool to initialize the database:

```shell
java -jar ./clm-service-cli/target/clm-service-cli-0.0.1-SNAPSHOT.jar ddl -d "./scripts" -c "jdbc:mysql://127.0.0.1:3306/clm?enabledTLSProtocols=TLSv1.2&characterEncoding=utf8&serverTimezone=GMT%2b0&useLegacyDatetimeCode=false" -u root -p 123456
```

### Running the Service


In the `src` directory, run the following command to start the restful service:

```shell
mvn -pl clm-service-rest -am spring-boot:run
```

Swagger document:

```text
http://localhost:1023/api/swagger-ui/index.html
```


### First Test


You can use `curl` to test the service. For example:

```shell
curl -X POST "http://localhost:1023/api/Cabinets" -H "accept: application/json" -H "Content-Type: application/json" -d '{"cabinetId":"CabinetId_1","active":true,"commandId":"11234324","description":"Test cabinet"}'
```

